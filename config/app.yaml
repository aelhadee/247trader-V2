# 247trader-v2 Application Configuration
# Rules-first, AI-optional architecture

app:
  name: "247trader-v2"
  version: "2.0.0"
  mode: "li"  # DRY_RUN | PAPER | LIVE

exchange:
  name: "coinbase"
  api_key: "${COINBASE_API_KEY}"
  api_secret: "${COINBASE_API_SECRET}"
  
  # Read-only mode for safety (must explicitly set to false for LIVE trading)
  read_only: true
  
  # Rate limits (per second)
  rate_limit:
    public: 10
    private: 5

loop:
  # Main execution loop
  interval_minutes: 1.0
  
  # Skip weekends/holidays
  skip_weekends: false
  
  # Timezone
  timezone: "UTC"
  
  # Jitter and auto-backoff (prevents synchronized bursts and overload)
  interval:
    seconds: 60              # Base interval
    jitter_pct: 10          # ±10% randomization
  utilization_autobackoff:
    target_util_pct: 70     # Trigger backoff at 70% utilization
    backoff_seconds: 15     # Add 15s when over target
  universe_cache_seconds: 300

auto_tune:
  # Bounded auto-loosening for prolonged zero-trigger periods
  zero_trigger_cycles: 12   # If 12 consecutive cycles have 0 triggers...
  loosen:
    pct_change_15m_delta: -0.2    # Reduce 15m threshold by 0.2%
    pct_change_60m_delta: -0.3    # Reduce 60m threshold by 0.3%
    min_conviction_delta: -0.02   # Reduce conviction by 0.02
  floors:
    pct_change_15m: 1.2     # Do not go below 1.2% for 15m
    pct_change_60m: 2.5     # Do not go below 2.5% for 60m
    min_conviction: 0.30    # Do not go below 0.30 conviction

logging:
  level: "INFO"  # DEBUG | INFO | WARNING | ERROR
  format: "json"  # json | text
  
  # File output
  file: "logs/247trader-v2.log"
  rotate: true
  max_bytes: 10485760  # 10MB
  backup_count: 5
  
  # Structured fields
  include_timestamps: true
  include_hostname: true
  
  # Sensitive data redaction
  redact_api_keys: true
  redact_tokens: true

state:
  # State persistence
  store: "sqlite"  # sqlite | redis | memory
  path: "data/state.db"
  
  # How often to persist
  persist_interval_seconds: 60
  
  # Backup state
  backup_enabled: true
  backup_interval_hours: 24

monitoring:
  # Health checks
  healthcheck_enabled: false
  healthcheck_port: 8080
  
  # Metrics
  metrics_enabled: true
  metrics_port: 9090
  
  # Alerts with dedupe and escalation
  alerts_enabled: false
  alerts:
    webhook_env: "ALERT_WEBHOOK_URL"
    min_severity: "warning"
    dry_run: false
    timeout_seconds: 5
    # Deduplication: suppress identical alerts within 60s window
    dedupe_seconds: 60.0
    # Escalation: boost severity after 2m unresolved
    escalation_seconds: 120.0
    escalation_webhook_url: "${ESCALATION_WEBHOOK_URL}"  # Optional separate webhook
    escalation_severity_boost: 1  # INFO→WARNING, WARNING→CRITICAL
