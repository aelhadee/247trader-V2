profile: day_trader  # Active profile for ~$250 account with 2.0% T2 sizing
profiles:
  # CONSERVATIVE: Mirrors Freqtrade (3 concurrent, -10% stop) and Jesse (1x leverage, $10k balance)
  # Recommended for: Initial deployment, limited capital (<$5k), low-risk tolerance
  conservative:
    min_conviction: 0.40  # High bar for entry (vs Freqtrade's default strategy filters)
    tier_sizing:
      T1: 0.015  # 1.5% of NAV per T1 trade (≈$150 on $10k)
      T2: 0.010  # 1.0% of NAV per T2 trade
      T3: 0.005  # 0.5% of NAV per T3 trade (disabled by default)
    max_position_pct:
      T1: 0.03   # Max 3% per T1 asset (2 adds allowed)
      T2: 0.02   # Max 2% per T2 asset
      T3: 0.01   # Max 1% per T3 asset
    min_trade_notional: 10.0  # $10 minimum (matches dust_threshold)
  
  # SWING_TRADER: Medium-term holds with lower conviction bar
  # Recommended for: Multi-day holds, trend-following strategies
  swing_trader:
    min_conviction: 0.34
    tier_sizing:
      T1: 0.02
      T2: 0.012
      T3: 0.005
    max_position_pct:
      T1: 0.04
      T2: 0.03
      T3: 0.02
    min_trade_notional: 9.0
  
  # DAY_TRADER: Original aggressive profile (95% at-risk, 40 trades/day)
  # Recommended for: Advanced users, supervised operation, proven strategies
  day_trader:
    min_conviction: 0.3
    tier_sizing:
      T1: 0.03
      T2: 0.020   # Increased from 0.018 (1.8%) to 0.020 (2.0%) for $250 accounts → $5.14 orders
      T3: 0.007
    max_position_pct:
      T1: 0.07
      T2: 0.06   # Increased from 0.045 (4.5%) to 0.06 (6%) for small accounts
      T3: 0.025
    min_trade_notional: 5.0  # Reduced from 15.0 to 5.0 for ~$250 accounts
risk:
  # CONSERVATIVE DEFAULTS (aligned with Freqtrade/Jesse/Hummingbot)
  # Freqtrade: 3 concurrent trades, -10% stop, 0.05 BTC stake (~$2.5k @ $50k BTC)
  # Jesse: 1x leverage, $10k initial balance
  # Hummingbot: Manual position sizing, no built-in pyramiding
  max_total_at_risk_pct: 25.0  # Conservative LIVE profile (≤25% NAV at risk). Was 80% temporarily to stop trim thrashing.
  count_external_positions: false
  managed_position_tag: 247trader
  external_exposure_buffer_pct: 5.0
  max_position_size_pct: 3.0   # Was 7% - REDUCED to Freqtrade's ~3% per trade (1/3 of NAV÷10)
  max_per_asset_pct: 4.0        # Was 5% - REDUCED to fit within theme caps (must be <= smallest theme cap)
  min_position_size_pct: 0.5
  max_open_positions: 5         # Was 12 - REDUCED to Freqtrade's 3-5 range for conservative operation
  max_per_theme_pct:
    LAYER1: 10.0                # Layer 1 blockchains (BTC, ETH, SOL, etc.)
    LAYER2: 6.0                 # Layer 2 scaling solutions (OP, ARB, etc.)
    MEME: 4.0                   # Meme coins (high volatility) - must be >= max_per_asset_pct
    DEFI: 5.0                   # DeFi protocols - total: 25% (fits max_total_at_risk_pct)
  
  # Stop-loss aligned with Freqtrade's -10% default
  daily_stop_pnl_pct: -3.0
  weekly_stop_pnl_pct: -7.0
  max_drawdown_pct: 10.0        # Matches Freqtrade's -10% stoploss
  
  # Trade pacing: Freqtrade has no explicit limits but recommends cooldowns via "Protections"
  # Our defaults enforce similar behavior to prevent overtrading
  max_trades_per_day: 120       # Was 15 - FIXED: must be ≥ hourly rate × 24 (5×24=120)
  max_trades_per_hour: 5        # Was 8 - REDUCED to prevent rapid-fire entries
  max_new_trades_per_hour: 3    # Was 8 - REDUCED to match conservative pace
  min_seconds_between_trades: 180  # Was 120s - INCREASED to 3min (Hummingbot-style spacing)
  per_symbol_trade_spacing_seconds: 900  # Was 600s - INCREASED to 15min cooldown
  
  # Cooldowns after losses (Freqtrade "Protections" analog)
  cooldown_after_loss_trades: 3
  cooldown_minutes: 60
  per_symbol_cooldown_enabled: true
  per_symbol_cooldown_minutes: 30
  per_symbol_cooldown_after_stop: 120  # Was 60min - INCREASED to 2h after stop-out
  
  # Differentiated per-symbol cooldowns by outcome (NEW)
  per_symbol_cooldown_win_minutes: 10    # Short cooldown after win (prevents overtrading)
  per_symbol_cooldown_loss_minutes: 60   # Longer cooldown after loss (time to reassess)
  # Note: stop_loss uses per_symbol_cooldown_after_stop (120min)
  
  # Sizing minimums
  min_trade_notional_usd: 5     # Reduced from 10 to 5 for small accounts (~$250)
  dust_threshold_usd: 5.0        # Lowered to match min_trade_notional
  
  # Pyramiding: DISABLED by default (Freqtrade/Hummingbot don't pyramid)
  # Advanced users can enable via day_trader profile
  allow_adds_when_over_cap: false  # Was true - CHANGED to prevent cap breaches
  count_open_orders_in_cap: true
  allow_pyramiding: false       # Was true - DISABLED to match reference apps
  pyramid_cooldown_seconds: 600  # Was 300s - INCREASED to 10min if re-enabled
  max_adds_per_asset_per_day: 1  # Was 2 - REDUCED to single add per day max
  
  # Stop/target levels (Freqtrade: -10% stop, +4% minimal ROI)
  stop_loss_pct: 10.0           # Was 8% - INCREASED to match Freqtrade's -10% default
  take_profit_pct: 12.0         # Was 15% - REDUCED to match Freqtrade's ~4-12% ROI targets
exits:
  enabled: true
  check_stop_loss: true
  check_take_profit: true
  check_max_hold: true
  use_trailing_stop: false
  trailing_stop_pct: 5.0
  exit_order_type: limit_ioc
  exit_slippage_tolerance_bps: 100
  tighten_stops_in_crash: true
  widen_targets_in_bull: true
position_sizing:
  method: risk_parity
  risk_per_trade_pct: 1.0
  fixed_size_usd: 100.0
  min_order_usd: 5.0             # Reduced from 10.0 to 5.0 for small accounts
  max_order_usd: 10000.0
  allow_pyramiding: false  # Aligned with risk.allow_pyramiding=false (conservative profile)
  max_pyramid_positions: 0  # Pyramiding disabled
liquidity:
  min_24h_volume_usd: 5000000  # Reduced from $8M to $5M (global fallback)
  max_spread_bps: 80
  min_depth_20bps_usd: 10000
  require_depth_mult: 10
  spreads_bps:
    T1: 20
    T2: 35
    T3: 60
  min_depth_floor_usd:
    T1: 50000
    T2: 25000
    T3: 10000
  slippage_budget_bps:
    T1: 60
    T2: 95
    T3: 120
  eligibility_persistence:
    ineligible_grace_cycles: 5
    eligible_grace_cycles: 2
triggers:
  only_upside: false
  price_move:
    pct_15m: 1.5
    pct_60m: 3.0
  volume_spike:
    ratio_1h_vs_24h: 1.9
  breakout:
    lookback_hours: 24
  min_score: 0.2
  fallback:
    enabled: true
    min_no_trigger_streak: 1
    relax_pct: 0.3
    max_new_positions_per_cycle: 1
    allow_downside: true
  mean_reversion:
    stop_atr: 1.2
    take_profit_atr: 1.8
    max_hold_hours: 48
strategy:
  base_position_pct:
    tier1: 0.03
    tier2: 0.020   # Increased from 0.018 (1.8%) to 0.020 (2.0%) for $250 accounts → $5.14 orders
    tier3: 0.007
  momentum_downside_reversal_pct: 3.0
  max_open_positions: 12
  max_new_positions_per_cycle: 1
  prefer_add_to_existing: true
  min_conviction_to_propose: 0.28  # Lowered from 0.30 (7% reduction) to capture more trades without going full degen
  conviction_weights:
    base: 0.0
    trigger_strength: 0.5
    trigger_confidence: 0.3
    quality_boosts:
      reversal_close_above_vwap_5m: 0.04
      reversal_higher_low: 0.04
      reversal_rsi_cross_50: 0.03
      reversal_bounce_confirmed: 0.04
      tier_bias_T1: 0.02
  reversal_confirmation:
    enforce: true
    min_required: 3
    qualifiers:
    - reversal_close_above_vwap_5m
    - reversal_higher_low
    - reversal_rsi_cross_50
    - reversal_bounce_confirmed
  canary:
    enabled: true
    size_multiplier: 0.25
    conviction_window:
      lower: 0.32
      upper: 0.34
      inclusive_upper: false
    require_tier_in:
    - T1
    - T2
    maker_only: true
microstructure:
  max_expected_slippage_bps: 50
  max_quote_age_seconds: 5
circuit_breakers:
  max_quote_age_seconds: 60
  max_ohlcv_age_seconds: 300
  max_consecutive_api_errors: 3
  api_error_window_seconds: 300
  check_exchange_status: true
  check_product_status: true
  halt_on_maintenance: true
  check_price_outliers: true
  max_price_deviation_pct: 10.0
  min_volume_ratio: 0.1
  outlier_lookback_periods: 20
  enable_atr_filter: true
  atr_lookback_periods: 14
  atr_min_multiplier: 1.1
  max_realized_volatility_pct: 150
  volatility_lookback_hours: 24
  min_eligible_assets: 2
  pause_on_rate_limit: true
  rate_limit_cooldown_seconds: 60
regime:
  enabled: true
  bull:
    position_size_multiplier: 1.2
    max_positions: 5
    allowed_signals:  # Signal filtering for regime
      - momentum
      - price_move
    signal_confidence_boost: 0.05  # +5% confidence in trending regime
  chop:
    position_size_multiplier: 0.8
    max_positions: 3
    allowed_signals:
      - mean_reversion
      - price_move
    signal_confidence_penalty: 0.1  # -10% confidence (choppy regime harder)
  bear:
    position_size_multiplier: 0.5
    max_positions: 2
    allowed_signals:
      - price_move  # Only strong moves in bear
    signal_confidence_boost: 0.0
  crash:
    position_size_multiplier: 0.0
    max_positions: 0
    allowed_signals: []  # NO TRADE in crash
execution:
  # CONSERVATIVE EXECUTION: Aligned with Freqtrade/Hummingbot timing patterns
  # Freqtrade: 10min unfilled timeout, GTC orders
  # Hummingbot: 30min max_order_age, periodic refresh
  maker_fee_bps: 40
  taker_fee_bps: 60
  default_order_type: limit_post_only
  min_notional_usd: 5.0         # Reduced from 10.0 to 5.0 for small accounts (~$250)
  maker_first: true
  maker_max_reprices: 1
  maker_max_ttl_sec: 30         # Was 15s - INCREASED to 30s (less aggressive canceling)
  maker_first_min_ttl_sec: 20   # Was 12s - INCREASED proportionally
  maker_retry_min_ttl_sec: 15   # Was 8s - INCREASED proportionally
  maker_reprice_decay: 0.7
  purge_maker_ttl_sec: 45       # Was 25s - INCREASED (allow more time for fills)
  taker_fallback: true
  prefer_ioc: true
  taker_max_slippage_bps:
    T1: 20
    T2: 40
    T3: 60
    default: 60
  auto_convert_preferred_quote: false  # Disabled - API lacks convert privileges
  clamp_small_trades: true
  small_order_market_threshold_usd: 6.0
  allow_min_bump_in_risk: true
  post_trade_reconcile_wait_seconds: 1.0  # Was 0.5s - INCREASED for reliable fills
  failed_order_cooldown_seconds: 300     # Was 180s - INCREASED to 5min (less retry pressure)
  preferred_quote_currencies:
  - USDC
  - USD
  - USDT
  - BTC
  - ETH
  max_slippage_bps: 40
  hard_max_spread_bps: 80
  slippage_budget_t1_bps: 60
  slippage_budget_t2_bps: 95
  slippage_budget_t3_bps: 120
  cancel_after_seconds: 60
  post_only_ttl_seconds: 15
  partial_fill_min_pct: 0.25
  max_order_age_seconds: 1800
  limit_offset_bps: 0
  limit_timeout_seconds: 30
  require_fill_confirmation: true
  fill_timeout_seconds: 60
  max_retries: 3
  retry_delay_seconds: 5
  cancel_retry_backoff_ms:
  - 250
  - 500
  - 1000
  promote_to_taker_if_budget_allows: false
  taker_promotion_requirements:
    min_confidence: 0.7
    max_slippage_bps: 50
  high_volatility:
    lookback_minutes: 60
    move_threshold_pct: 8.0
    size_reduction_factor: 0.5
portfolio_management:
  auto_liquidate_ineligible: true
  min_liquidation_value_usd: 5   # Reduced from 10 to 5 for small accounts
  max_liquidations_per_cycle: 2
  auto_trim_to_risk_cap: true
  trim_target_buffer_pct: 10.0
  trim_tolerance_pct: 0.25
  trim_min_value_usd: 5.0        # Reduced from 10.0 to 5.0 for small accounts
  trim_max_liquidations: 5
  # Auto-trim escalation alerting
  max_trim_failures_before_alert: 3  # Alert after 3 consecutive trim failures
  trim_preferred_quotes:
  - USDC
  - USD
  - USDT
  trim_slippage_buffer_pct: 5.0
  auto_rebalance_worst_performer: true
  purge_execution:
    slice_usd: 5.0               # Reduced from 10.0 to 5.0 to match min_notional (small accounts + T3 assets)
    maker_ttl_sec: 25
    maker_first_ttl_sec: 25
    maker_retry_ttl_sec: 20
    replace_seconds: 45
    max_duration_seconds: 240
    poll_interval_seconds: 2.0
    max_slices: 24
    max_residual_usd: 8.0        # Reduced from 12.0 to 8.0 for small accounts
    max_consecutive_no_fill: 2
    allow_taker_fallback: true
    taker_fallback_threshold_usd: 25.0  # Lowered from 50.0 to use taker sooner
    taker_max_slippage_bps: 100
    cushion_ticks: 1
    max_cushion_ticks: 3
twap:
  replace_seconds: 45
cooldowns:
  bypass_tags:
  - purge
  - trim
loop:
  interval_seconds: 60
  universe_cache_seconds: 300
  # Jitter applied to interval_seconds to avoid lockstep behavior with other bots
  # Set to 0.0 to disable jitter
  jitter_pct: 10.0  # 0-10% random jitter per cycle (prevents synchronized bursts)
ai:
  enabled: false
  m1_model: gpt-4o
  m2_model: gpt-4o
  m3_model: o3-mini
  openai_api_key: ${OPENAI_API_KEY}
  ai_can_create_symbols: false
  ai_can_override_risk: false
  ai_max_position_adjustment_pct: 20
  news_sources:
  - coindesk.com
  - theblock.co
  - cointelegraph.com
  max_ai_calls_per_hour: 60
  max_cost_per_cycle_usd: 2.0
governance:
  live_trading_enabled: true
  require_decision_reasoning: true
  min_reasoning_length: 50
  log_all_decisions: true
  log_ai_prompts: true
  log_ai_responses: true
  allow_manual_override: true
  require_override_reason: true
  kill_switch_enabled: true
  kill_switch_file: data/KILL_SWITCH
  emergency_slack_webhook: ${SLACK_WEBHOOK_URL}
  emergency_email: ${ALERT_EMAIL}
data:
  max_age_s: 60
  max_quote_staleness_seconds: 30
circuit_breaker:
  api_error_threshold: 5
  api_error_window_minutes: 5
  rate_limit_threshold: 3
  rate_limit_window_minutes: 10

# Per-endpoint rate limit tracking (prevents API quota exhaustion)
rate_limits:
  # Coinbase Advanced Trade API limits (as of 2024):
  # - Public endpoints: 10 requests/second
  # - Private endpoints: 15 requests/second
  # - Orders: 10 orders/second
  
  # Default quotas (used if endpoint-specific not configured)
  public: 10.0   # req/sec for public endpoints
  private: 15.0  # req/sec for private endpoints
  
  # Alert thresholds (0.0-1.0 utilization)
  alert_threshold: 0.8  # Alert at 80% utilization
  critical_threshold: 0.9  # Critical alert at 90%
  
  # Per-endpoint overrides (optional)
  endpoints:
    get_quote: 10.0          # Quote fetching
    get_ohlcv: 10.0          # Candle data
    list_products: 5.0       # Product listing (less frequent)
    get_accounts: 10.0       # Account balances
    list_orders: 10.0        # Order listing
    list_fills: 10.0         # Fill history
    place_order: 10.0        # Order placement
    cancel_order: 10.0       # Order cancellation
    preview_order: 10.0      # Order preview
    convert_quote: 5.0       # Currency conversion (less frequent)
    convert_commit: 5.0      # Conversion execution

# Latency thresholds for watchdog timers and alerting
latency:
  # API call latency thresholds in milliseconds (mean over last N calls)
  api_thresholds_ms:
    api_list_products: 2000        # Product list should complete in 2s
    api_get_accounts: 1500          # Account fetch in 1.5s
    api_list_open_orders: 1500      # Open orders in 1.5s
    api_list_fills: 2000            # Fill history in 2s
    api_get_quote: 500              # Single quote in 500ms
    api_place_order: 2000           # Order placement in 2s
    api_cancel_order: 1500          # Order cancellation in 1.5s
    api_preview_order: 1000         # Order preview in 1s
  
  # Decision cycle stage budgets in seconds
  stage_budgets:
    order_reconcile: 2.0
    universe_build: 15.0 #was 6.0
    trigger_scan: 6.0
    rules_engine: 4.0
    risk_engine: 4.0
    execution: 15.0
    open_order_maintenance: 3.0
    exit_checks: 3.0
    exit_execution: 3.0
  
  # Total cycle budget in seconds (fail-safe for runaway cycles)
  total_seconds: 45.0
  
  # Alert on persistent slowness (trigger after N consecutive violations)
  alert_after_violations: 3
